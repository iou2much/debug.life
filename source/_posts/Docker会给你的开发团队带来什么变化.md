title: 【译文】Docker会给你的开发团队带来什么变化？ 
date: 2016-02-12 08:32:09
toc: true
category: 翻译
description: 长久以来，软件测试团队等待着一个合适的测试版本已经是个老问题，开发环境、测试环境、生产环境之间的差异总会导致生产版本有缺陷被遗漏了。虚拟机的出现解决了这些问题，但是同时也带来了性能的下降，还有磁盘的大量浪费。Docker的出现.....

---

长久以来，软件测试团队等待着一个合适的测试版本已经是个老问题，开发环境、测试环境、生产环境之间的差异总会导致生产版本有缺陷被遗漏了。虚拟机的出现解决了这些问题，但是同时也带来了性能的下降，还有磁盘的大量浪费。

这时候，Docker出场了，它是Linux下一款轻量且高性能的虚拟化工具。

## Docker带来的机会

首先，技术团队中任何人都可以迅速在本地创建一个测试环境，只需要在已有的操作系统下启动新的进程，所以不需要系统的启动。如果基于一个旧版本的镜像创建，Docker可以只加载两个构建之间的差异。

这种易用性让很多团队都采用了Docker方案，如果这种部署架构延伸到生产环境，那生产环境的部署也能变得这么简单。

另一个高明的做法是这样，把一些纯净的虚拟化集群部署到数个虚拟机上，把部署的这个版本称为"green"构建，所有的回归测试都在这个"green"构建中实施，相当于生产环境的一个副本。当测试完成后，只需用一个脚本调整这些服务器，那这些"green"构建就变成了生产环境了。而前一个构建的版本，可以保留着，以备需要回滚操作。这种部署方式称为["blue/green"部署](http://martinfowler.com/bliki/BlueGreenDeployment.html)，可以用好几种技术实现。
Docker使得这种方式更简单了。

## 为什么选Docker?

基于Windows的软件可以被编译成一个单独的安装包，而基于Web的软件交付的方式完全不同：构建出的软件须运行在服务器上。网站的典型发布流程涉及起码三到四层：开发环境，测试环境，生产环境，有时还会有准生产环境，这种方式每层都至少包含一台服务器。并且每层的升级通常有固定的发布规则，一旦软件满足某种条件，就会被部署到下一层的环境中。

虚拟机使这种情况发生了变化，能让服务器的数量和开发团队的人数一样多。这样就可以让每个分支都独立测试，最后才合并到主版本以供集成测试，这种方案可以省下大量采购新三件的费用。使用虚拟机也能让开发人员在本地调试生产环境出现的问题，同时测试人员也可以在另一台机器上重新测试一个补丁；一个测试人员回归测试着即将发布的版本，而另外五个测试人员测试着下一版本的特性，还可以有五个开发人员在开发着新的分支。
[相关阅读: Top cloud Infrastructure-as-a-Service vendors](http://www.cio.com/article/2947282/cloud-infrastructure/top-cloud-infrastructure-as-a-service-vendors.html)

虚拟机的问题是容量和性能，每个虚拟机都需要包含着整个操作系统，新建一个虚拟机意味要多分配数GB的硬盘空间，用以创建一个全新的操作系统，才能把构建的应用部署到这个操作系统中。更糟糕的是，这个操作系统需要运行在宿主系统的用户空间，这样相当于在一个操作系统上跑着另一个操作系统。启动或者安装一个新的应用到虚拟机中，通常都需要数分钟甚至一小时，这样很容易原有的工作计划。技术人员的电脑上很可能只能装上一到两个虚拟机，这样才能避免严重的性能下降。后来出现的“私有云计算”，就是这种方案延伸到在网络上使用虚拟机。

Docker运行在主系统的内核空间，而不是用户空间，换言之它本身是使用了操作系统本身的一部分，这样确实是会限制了Docker只能是在现代Linux内核中运行，但是这也极大的简化了操作系统的进程切换。在内核中运行Docker避免了像虚拟机引起的资源浪费，而且Docker容器系统不需要“额外启动”，因为它本来就已经“启动”了。

这些特性使得Docker方案能以极快的速度创建服务器——而且是能直接部署到生产环境的基于整个磁盘的镜像，而不是作为一个现有系统的补丁。

Docker还可以停止并保存容器的错误状态，让开发者稍后调试，这使得在Docker下调试更方便了，如果调试过程中破坏了重现bug的环境，那么恢复到之前保存的错误状态就可以把bug重现了。Docker可以在任意的Linux服务器上运行任意的应用，它的快速部署和快速销毁的特性让它也很适合用于批处理的任务。
[相关阅读: Why the open container project is good news for CIOs](http://www.cio.com/article/2951834/virtualization/why-the-open-container-project-is-good-news-for-cios.html)

开源社区上有一些工具可以帮助配置甚至用Docker模拟整套服务器集群的，最受欢迎的是Docker Compose，这工具能让复杂的搭建过程简化到一个命令。

## 生产环境上的Docker

在本地或者云服务上的Docker服务是一回事，要使它能在生产环境上使用又完全是另一回事了。在初期要在生产环境上以Docker部署还是有点单薄，而现在最常见的术语是“容器编排”，这技术让Docker化的应用和服务能有组织地部署到服务器上，通过它，我们可以不关心容器到底部署在哪台服务器上，只需要它们正在服务着，无论这些应用是流量监控、内部服务、数据库或者是消息队列，都能以这种方式部署。

目前最成熟的编排产品是AWS EC2 Container Service，Docker Swarm 和 Mesos。典型的编排技术核心是管理容器，但通常也有一些附带的功能，例如"blue/green"部署，容器修复，负载均衡，服务发现和容器网络配置等。

当要在生产环境上使用Docker时，还有其他一些地方要注意的，例如日志记录，环境变量配置等。在[12 Factor App](http://12factor.net/)这个网站上有很多资源可以参考。

Don Taylor的CodeMash应用Docker指南介绍了如何在Linux系统上安装Docker，还有一些常用的管理命令，他还在github上开源了一些[实验示例](https://github.com/TechConf/CodeMash2015/tree/master/Get%20Shipping%20with%20Docker)。

没尝试过Docker的读者可以安装一个Linux虚拟机，在上边安装好Docker，探索一下如何使用容器等技术，再决定这个技术是否合适您的团队吧。


